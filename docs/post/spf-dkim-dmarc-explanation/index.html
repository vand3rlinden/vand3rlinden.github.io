<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>SPF, DKIM and DMARC explanation | VAND3RLINDEN</title>
<meta name="keywords" content="">
<meta name="description" content="In this post you will learn to understand SPF, DKIM, DMARC and how these DNS protocols work together to protect your domain from phishers and spammers.
SPF What is SPF Sender Policy Framework (SPF) is a protocol that aims to reduce spam. SPF can reduce email spoofing and spam by determining if the sender is authorized to send on behalf of the listed sender.
How SPF works Imagine that you have an SPF record that looks like: v=spf1 include:_spf.">
<meta name="author" content="">
<link rel="canonical" href="https://vand3rlinden.com/post/spf-dkim-dmarc-explanation/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.9329d037bc79464b26647fb72e079cd738f5d2418b1df4da3b515db9e22cb4d9.css" integrity="sha256-kynQN7x5RksmZH&#43;3Lgec1zj10kGLHfTaO1FdueIstNk=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://vand3rlinden.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://vand3rlinden.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://vand3rlinden.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://vand3rlinden.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://vand3rlinden.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="SPF, DKIM and DMARC explanation" />
<meta property="og:description" content="In this post you will learn to understand SPF, DKIM, DMARC and how these DNS protocols work together to protect your domain from phishers and spammers.
SPF What is SPF Sender Policy Framework (SPF) is a protocol that aims to reduce spam. SPF can reduce email spoofing and spam by determining if the sender is authorized to send on behalf of the listed sender.
How SPF works Imagine that you have an SPF record that looks like: v=spf1 include:_spf." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://vand3rlinden.com/post/spf-dkim-dmarc-explanation/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-12-09T11:46:16+01:00" />
<meta property="article:modified_time" content="2023-12-09T11:46:16+01:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SPF, DKIM and DMARC explanation"/>
<meta name="twitter:description" content="In this post you will learn to understand SPF, DKIM, DMARC and how these DNS protocols work together to protect your domain from phishers and spammers.
SPF What is SPF Sender Policy Framework (SPF) is a protocol that aims to reduce spam. SPF can reduce email spoofing and spam by determining if the sender is authorized to send on behalf of the listed sender.
How SPF works Imagine that you have an SPF record that looks like: v=spf1 include:_spf."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://vand3rlinden.com/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "SPF, DKIM and DMARC explanation",
      "item": "https://vand3rlinden.com/post/spf-dkim-dmarc-explanation/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SPF, DKIM and DMARC explanation",
  "name": "SPF, DKIM and DMARC explanation",
  "description": "In this post you will learn to understand SPF, DKIM, DMARC and how these DNS protocols work together to protect your domain from phishers and spammers.\nSPF What is SPF Sender Policy Framework (SPF) is a protocol that aims to reduce spam. SPF can reduce email spoofing and spam by determining if the sender is authorized to send on behalf of the listed sender.\nHow SPF works Imagine that you have an SPF record that looks like: v=spf1 include:_spf.",
  "keywords": [
    
  ],
  "articleBody": " In this post you will learn to understand SPF, DKIM, DMARC and how these DNS protocols work together to protect your domain from phishers and spammers.\nSPF What is SPF Sender Policy Framework (SPF) is a protocol that aims to reduce spam. SPF can reduce email spoofing and spam by determining if the sender is authorized to send on behalf of the listed sender.\nHow SPF works Imagine that you have an SPF record that looks like: v=spf1 include:_spf.domain.com ip4:11.222.33.444 -all\nIf an unauthorized server sends on behalf of your domain, the email will get an spf=fail in the message header because that IP is not listed in your SPF record.\nSPF will pass if the sender’s IP is added to the SPF record for the P1 Sender domain.\nP1 vs P2- sender explanation: Postal Letter Precise Term Protected by Sender on envelope RFC5321.MailFrom (P1 Sender) SPF Author on letter RFC5322.From (P2 Sender) DKIM + DMARC Implementation of SPF When you add your domain to Microsoft 365, Microsoft will ask you to provide an SPF record, such as v=spf1 include:spf.protection.outlook.com -all. If you have more allowed senders, you must include them in the SPF record. For example v=spf1 include:spf.protection.outlook.com include:_spf.domain.com ip4:11.222.33.444 -all\nThe SPF record will differ for everyone; therefore, it is important to understand the following when implement an SPF- record:\nCan only have 255 characters, but it can be split to multiple strings in a single record, most DNS providers handle this automatically. Example: v=spf1 first string” “second string -all Can take up to a maximum of 10 DNS Look Ups like include:spf.protection.outlook.com (which already include two DNS lookups) Avoiding the 10 DNS Look Ups cap, to: Flatten your SPF record (not recommended) Example: v=spf1 include:spf.domain.com -all can be v=spf1 ip4:11.222.33.444 ip4:11.222.33.444 -all. Problem with flattening is that email service providers may change or add IP addresses without telling you. Then your SPF record is inaccurate, which leads into email delivery problems\nNot using entries like a and mx, these mechanisms are often useless and probably should not be included in your SPF record (and other duplicate SPF mechanisms).\nMove to vendor traffic with using subdomains for SPF authentication. Subdomain segmentation creates a new domain dedicated to a particular mail stream with its own 10 DNS Look Ups. Learn more about this in this post.\nSoftfail or Hardfail SPF can get a softfail or fail, you determine this at the end of the record.\nWith ~all: If an email is sent from a host or IP that is not in the SPF record, the message will still pass, but it can be flagged as spam (Softfail).\nWith -all: If an email is sent from a host or IP that is not in the SPF record, it can be rejected by the receiving server (HardFail).\nLimitations of SPF Although SPF works relatively well in theory, there are several flaws in the protocol that mean that SPF alone is not enough to protect a sending domain.\nThe SPF protocol only protects the P1 sender and not the content of the email, which is the P2 sender of the email. DKIM was set up to protect the P2 sender by adding a signature (SHA-256 hash function) to the email.\nThen there is the problem that not every receiving mail server has an active policy for SPF and DKIM, which is why DMARC was created. With DMARC, the sender specifies on behalf of their domain what should be done with email that does not meet the requirements. DMARC can be used to protect the P2 sender as a last line of defense.\nDKIM What is DKIM DomainKeys Identified Mail (DKIM) is an authentication-based technique, by using DKIM, the receiving mail server can check the authenticity of a e-mail with the DKIM-Signature header. This signature is created using the SHA-256 hash function.\nHow DKIM works The receiving server makes a DNS request using the sender’s domain name (P2 Sender). In response to the DNS request, the receiving server obtains the public key from a DNS record in the DNS zone of the sending domain, such as selector1._domainkey.yourdomain.com, and compares it to the private key in the message from the sending server.\nDKIM will pass if the sending server’s private key can be confirmed by the receiving server, using the public key in the sending domain’s DNS zone. This public key is published in a TXT/CNAME record. For example, when in TXT:\nHostname: key1._domainkey.yourdomain.com (in TXT) Value: v=DKIM1;t=s;p=MIIBIjANBgkqhkiG9w0BA... (public key) Implementation of DKIM You can configure DKIM with a TXT record in your DNS zone for your sending mail servers (such as postfix or sendmail). A DKIM generator can be used to generate a private key for your server and a public key for your DNS.\nNote: that a DKIM record is required for each sending server or mail provider.\nHow you set up DKIM can vary depending on your mail provider; setting up DKIM for Google Workplace differs from Exchange Online in Microsoft Defender for Office 365.\nDMARC What is DMARC DMARC (Domain-based Message Authentication, Reporting and Conformance) acts as a shield on top of SPF and DKIM. With DMARC, the sender specifies what to do with email on behalf of the domain if it does not meet the requirements of SPF and DKIM.\nHow DMARC works Once your domain has a DMARC record, any receiving email server can verify the incoming email based on the instructions in the DMARC policy. If the email passes the DMARC authentication, it will be delivered and can be trusted. If the email fails the check, depending on the instructions in the DMARC record, the email can be delivered, quarantined, or rejected.\nDMARC will pass if the P1 Sender and P2 Sender are equal, and/or SPF and DKIM are passed. If the P1 sender is not equal to the P2 sender, then DKIM must pass for the P2 sender domain in order to get a DMARC pass.\nImplementation of DMARC Before using DMARC, you need to know how often it will fail. You should consider to start monitor the DMARC fails, before setting the DMARC policy directly on reject.\nThere are several monitoring tools that convert the unreadable XML DMARC reports into a clear dashboard. One such tool is Valimail (free for Microsoft 365 users with an Exchange Online plan).\nFor heavy mail domains, I recommended monitoring the domain for at least three months with the DMARC policy set to none:\nHostname: _dmarc Value: v=DMARC1; p=none; sp=none; rua=mailto:dmarc_agg@vali.email; Note: I recommend mirroring the SPF record with the DMARC policy, use ~all at the end of your SPF record when your DMARC policy is on none. Deploy -all once you have moved to reject on the DMARC policy.\nAfter the monitoring phase, we set the DMARC policy to reject:\nValue: v=DMARC1; p=reject; sp=reject; rua=mailto:dmarc_agg@vali.email; sp=reject means that subdomains will be included; if you don’t want your subdomains to be included in your domain’s root DMARC policy, you can set this to sp=none and list a separate DMARC policy for each subdomain (not recommended).\nIf you do not list the sp= tag, your subdomains will get the policy from the p= tag.\nSPF, DKIM and DMARC in short SPF performs verification that the IP address of the sending server matches the entry in the SPF record from the sending domain.\nSPF protects the P1 sender domain (Envelope sender, RFC5321.MailFrom). DKIM verifies if the public key (DNS record from sending domain) of a sending domain, matched the private key that came from the sending server. This is a check that the sending domain actually sent the e-mail. DKIM must be configured for each sending server, such as Exchange Online or any other server/SaaS service.\nDKIM protects the P2 sender domain (Letter sender, which recipients see in their email client, RFC5322.From). DMARC acts as a shield on top of SPF and DKIM. DMARC ensures that emails that fail the SPF and/or DKIM tests do not get through.\nDMARC protects the P2 sender domain (Letter sender, which recipients see in their email client, RFC5322.From). Finalizing Protect all non-sending domains with a restrictive deny all SPF record: v=spf1 -all and a reject DMARC record: v=DMARC1; p=reject;. Bad actors will actively look for unused domains to exploit.\nI hope that I was able to explain on how to use SPF, DKIM and DMARC in your environment.\n",
  "wordCount" : "1392",
  "inLanguage": "en",
  "datePublished": "2023-12-09T11:46:16+01:00",
  "dateModified": "2023-12-09T11:46:16+01:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://vand3rlinden.com/post/spf-dkim-dmarc-explanation/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "VAND3RLINDEN",
    "logo": {
      "@type": "ImageObject",
      "url": "https://vand3rlinden.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://vand3rlinden.com/" accesskey="h" title="VAND3RLINDEN (Alt + H)">VAND3RLINDEN</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      SPF, DKIM and DMARC explanation
    </h1>
    <div class="post-meta"><span title='2023-12-09 11:46:16 +0100 CET'>December 9, 2023</span>

</div>
  </header> 
  <div class="post-content"><blockquote>
<p><em>In this post you will learn to understand SPF, DKIM, DMARC and how these DNS protocols work together to protect your domain from phishers and spammers.</em></p>
</blockquote>
<h2 id="spf">SPF<a hidden class="anchor" aria-hidden="true" href="#spf">#</a></h2>
<h3 id="what-is-spf">What is SPF<a hidden class="anchor" aria-hidden="true" href="#what-is-spf">#</a></h3>
<p>Sender Policy Framework (SPF) is a protocol that aims to reduce spam. SPF can reduce email spoofing and spam by determining if the sender is authorized to send on behalf of the listed sender.</p>
<h3 id="how-spf-works">How SPF works<a hidden class="anchor" aria-hidden="true" href="#how-spf-works">#</a></h3>
<p>Imagine that you have an SPF record that looks like: <code>v=spf1 include:_spf.domain.com ip4:11.222.33.444 -all</code></p>
<p>If an unauthorized server sends on behalf of your domain, the email will get an spf=fail in the message header because that IP is not listed in your SPF record.</p>
<p>SPF will pass if the sender’s IP is added to the SPF record for the P1 Sender domain.</p>
<h3 id="p1-vs-p2--sender-explanation">P1 vs P2- sender explanation:<a hidden class="anchor" aria-hidden="true" href="#p1-vs-p2--sender-explanation">#</a></h3>
<table>
<thead>
<tr>
<th>Postal Letter</th>
<th>Precise Term</th>
<th>Protected by</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sender on envelope</td>
<td>RFC5321.MailFrom (P1 Sender)</td>
<td>SPF</td>
</tr>
<tr>
<td>Author on letter</td>
<td>RFC5322.From (P2 Sender)</td>
<td>DKIM + DMARC</td>
</tr>
</tbody>
</table>
<h3 id="implementation-of-spf">Implementation of SPF<a hidden class="anchor" aria-hidden="true" href="#implementation-of-spf">#</a></h3>
<p>When you add your domain to Microsoft 365, Microsoft will ask you to provide an SPF record, such as <code>v=spf1 include:spf.protection.outlook.com -all</code>. If you have more allowed senders, you must include them in the SPF record. For example <code>v=spf1 include:spf.protection.outlook.com include:_spf.domain.com ip4:11.222.33.444 -all</code></p>
<p>The SPF record will differ for everyone; therefore, it is important to understand the following when implement an SPF- record:</p>
<ul>
<li>Can only have 255 characters, but it can be split to multiple strings in a single record, most DNS providers handle this automatically.
<ul>
<li>Example: <code>v=spf1 first string” “second string -all</code></li>
</ul>
</li>
<li>Can take up to a maximum of 10 DNS Look Ups like <code>include:spf.protection.outlook.com</code> (which already include two DNS lookups)</li>
</ul>
<h3 id="avoiding-the-10-dns-look-ups-cap-to">Avoiding the 10 DNS Look Ups cap, to:<a hidden class="anchor" aria-hidden="true" href="#avoiding-the-10-dns-look-ups-cap-to">#</a></h3>
<ul>
<li>Flatten your SPF record (not recommended)
<ul>
<li>Example: <code>v=spf1 include:spf.domain.com -all</code> can be <code>v=spf1 ip4:11.222.33.444 ip4:11.222.33.444 -all</code>.</li>
</ul>
</li>
</ul>
<p>Problem with flattening is that email service providers may change or add IP addresses without telling you. Then your SPF record is inaccurate, which leads into email delivery problems</p>
<ul>
<li>
<p>Not using entries like <code>a</code> and <code>mx</code>, these mechanisms are often useless and probably should not be included in your SPF record (and other duplicate SPF mechanisms).</p>
</li>
<li>
<p>Move to vendor traffic with using subdomains for SPF authentication. Subdomain segmentation creates a new domain dedicated to a particular mail stream with its own 10 DNS Look Ups. Learn more about this in this post.</p>
</li>
</ul>
<h3 id="softfail-or-hardfail">Softfail or Hardfail<a hidden class="anchor" aria-hidden="true" href="#softfail-or-hardfail">#</a></h3>
<p>SPF can get a softfail or fail, you determine this at the end of the record.</p>
<ul>
<li>
<p>With <code>~all</code>: If an email is sent from a host or IP that is not in the SPF record, the message will still pass, but it can be flagged as spam (Softfail).</p>
</li>
<li>
<p>With <code>-all</code>: If an email is sent from a host or IP that is not in the SPF record, it can be rejected by the receiving server (HardFail).</p>
</li>
</ul>
<h3 id="limitations-of-spf">Limitations of SPF<a hidden class="anchor" aria-hidden="true" href="#limitations-of-spf">#</a></h3>
<p>Although SPF works relatively well in theory, there are several flaws in the protocol that mean that SPF alone is not enough to protect a sending domain.</p>
<p>The SPF protocol only protects the P1 sender and not the content of the email, which is the P2 sender of the email. DKIM was set up to protect the P2 sender by adding a signature (SHA-256 hash function) to the email.</p>
<p>Then there is the problem that not every receiving mail server has an active policy for SPF and DKIM, which is why DMARC was created. With DMARC, the sender specifies on behalf of their domain what should be done with email that does not meet the requirements. DMARC can be used to protect the P2 sender as a last line of defense.</p>
<h2 id="dkim">DKIM<a hidden class="anchor" aria-hidden="true" href="#dkim">#</a></h2>
<h3 id="what-is-dkim">What is DKIM<a hidden class="anchor" aria-hidden="true" href="#what-is-dkim">#</a></h3>
<p>DomainKeys Identified Mail (DKIM) is an authentication-based technique, by using DKIM, the receiving mail server can check the authenticity of a e-mail with the DKIM-Signature header. This signature is created using the SHA-256 hash function.</p>
<h3 id="how-dkim-works">How DKIM works<a hidden class="anchor" aria-hidden="true" href="#how-dkim-works">#</a></h3>
<p>The receiving server makes a DNS request using the sender’s domain name (P2 Sender). In response to the DNS request, the receiving server obtains the public key from a DNS record in the DNS zone of the sending domain, such as selector1._domainkey.yourdomain.com, and compares it to the private key in the message from the sending server.</p>
<p>DKIM will pass if the sending server’s private key can be confirmed by the receiving server, using the public key in the sending domain’s DNS zone. This public key is published in a TXT/CNAME record. For example, when in TXT:</p>
<ul>
<li>Hostname: <code>key1._domainkey.yourdomain.com</code> (in TXT)</li>
<li>Value: <code>v=DKIM1;t=s;p=MIIBIjANBgkqhkiG9w0BA...</code> (public key)</li>
</ul>
<h3 id="implementation-of-dkim">Implementation of DKIM<a hidden class="anchor" aria-hidden="true" href="#implementation-of-dkim">#</a></h3>
<p>You can configure DKIM with a TXT record in your DNS zone for your sending mail servers (such as postfix or sendmail). A DKIM generator can be used to generate a private key for your server and a public key for your DNS.</p>
<blockquote>
<p><em>Note: that a DKIM record is required for each sending server or mail provider.</em></p>
</blockquote>
<p>How you set up DKIM can vary depending on your mail provider; setting up DKIM for <a href="https://support.google.com/a/answer/180504?hl=en">Google Workplace</a> differs from <a href="https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/email-authentication-dkim-configure?view=o365-worldwide#steps-to-create-enable-and-disable-dkim-from-microsoft-defender-portal">Exchange Online</a> in Microsoft Defender for Office 365.</p>
<h2 id="dmarc">DMARC<a hidden class="anchor" aria-hidden="true" href="#dmarc">#</a></h2>
<h3 id="what-is-dmarc">What is DMARC<a hidden class="anchor" aria-hidden="true" href="#what-is-dmarc">#</a></h3>
<p>DMARC (Domain-based Message Authentication, Reporting and Conformance) acts as a shield on top of SPF and DKIM. With DMARC, the sender specifies what to do with email on behalf of the domain if it does not meet the requirements of SPF and DKIM.</p>
<h3 id="how-dmarc-works">How DMARC works<a hidden class="anchor" aria-hidden="true" href="#how-dmarc-works">#</a></h3>
<p>Once your domain has a DMARC record, any receiving email server can verify the incoming email based on the instructions in the DMARC policy. If the email passes the DMARC authentication, it will be delivered and can be trusted. If the email fails the check, depending on the instructions in the DMARC record, the email can be delivered, quarantined, or rejected.</p>
<p>DMARC will pass if the P1 Sender and P2 Sender are equal, and/or SPF and DKIM are passed. If the P1 sender is not equal to the P2 sender, then DKIM must pass for the P2 sender domain in order to get a DMARC pass.</p>
<h3 id="implementation-of-dmarc">Implementation of DMARC<a hidden class="anchor" aria-hidden="true" href="#implementation-of-dmarc">#</a></h3>
<p>Before using DMARC, you need to know how often it will fail. You should consider to start monitor the DMARC fails, before setting the DMARC policy directly on reject.</p>
<p>There are several monitoring tools that convert the unreadable XML DMARC reports into a clear dashboard. One such tool is <a href="https://www.valimail.com/blog/office-365-free-dmarc-monitoring/">Valimail</a> (free for Microsoft 365 users with an Exchange Online plan).</p>
<p>For heavy mail domains, I recommended monitoring the domain for at least three months with the DMARC policy set to <code>none</code>:</p>
<ul>
<li>Hostname: <code>_dmarc</code></li>
<li>Value: <code>v=DMARC1; p=none; sp=none; rua=mailto:dmarc_agg@vali.email;</code></li>
</ul>
<blockquote>
<p><em>Note: I recommend mirroring the SPF record with the DMARC policy, use <code>~all</code> at the end of your SPF record when your DMARC policy is on <code>none</code>.
Deploy <code>-all</code> once you have moved to <code>reject</code> on the DMARC policy.</em></p>
</blockquote>
<p>After the monitoring phase, we set the DMARC policy to <code>reject</code>:</p>
<ul>
<li>Value: <code>v=DMARC1; p=reject; sp=reject; rua=mailto:dmarc_agg@vali.email;</code></li>
</ul>
<p><code>sp=reject</code> means that subdomains will be included; if you don’t want your subdomains to be included in your domain’s root DMARC policy, you can set this to sp=none and list a separate DMARC policy for each subdomain (not recommended).</p>
<p>If you do not list the <code>sp=</code> tag, your subdomains will get the policy from the <code>p=</code> tag.</p>
<h3 id="spf-dkim-and-dmarc-in-short">SPF, DKIM and DMARC in short<a hidden class="anchor" aria-hidden="true" href="#spf-dkim-and-dmarc-in-short">#</a></h3>
<p>SPF performs verification that the IP address of the sending server matches the entry in the SPF record from the sending domain.</p>
<ul>
<li>SPF protects the P1 sender domain (Envelope sender, RFC5321.MailFrom).</li>
</ul>
<p>DKIM verifies if the public key (DNS record from sending domain) of a sending domain, matched the private key that came from the sending server. This is a check that the sending domain actually sent the e-mail. DKIM must be configured for each sending server, such as Exchange Online or any other server/SaaS service.</p>
<ul>
<li>DKIM protects the P2 sender domain (Letter sender, which recipients see in their email client, RFC5322.From).</li>
</ul>
<p>DMARC acts as a shield on top of SPF and DKIM. DMARC ensures that emails that fail the SPF and/or DKIM tests do not get through.</p>
<ul>
<li>DMARC protects the P2 sender domain (Letter sender, which recipients see in their email client, RFC5322.From).</li>
</ul>
<h3 id="finalizing">Finalizing<a hidden class="anchor" aria-hidden="true" href="#finalizing">#</a></h3>
<p>Protect all non-sending domains with a restrictive <em><strong>deny all SPF</strong></em> record: <code>v=spf1 -all</code> and a <em><strong>reject DMARC</strong></em> record: <code>v=DMARC1; p=reject;</code>. Bad actors will actively look for unused domains to exploit.</p>
<hr>
<p>I hope that I was able to explain on how to use SPF, DKIM and DMARC in your environment.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://vand3rlinden.com/">VAND3RLINDEN</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
