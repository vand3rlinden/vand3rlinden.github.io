<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Exchange Online: Configure inbound SMTP DANE with DNSSEC | VAND3RLINDEN</title>
<meta name="keywords" content="">
<meta name="description" content="
In this post, you will learn how to enable and use SMTP DANE with DNSSEC in Exchange Online.
While outbound SMTP DANE with DNSSEC in Exchange Online has been enabled since 2022, Microsoft is has rolling out inbound SMTP DANE with DNSSEC in Exchange Online since late 2024.

For a deeper understanding of DNSSEC and DANE, take a look at my earlier blog post.
How SMTP DANE with DNSSEC works
SMTP DANE is a security protocol that uses DNSSEC to verify the authenticity of TLS certificates used for securing email communication. It helps protect against attacks such as TLS downgrade and man-in-the-middle attacks by ensuring that the certificates and encryption settings used in mail server communications are authentic and trustworthy.">
<meta name="author" content="">
<link rel="canonical" href="https://vand3rlinden.com/post/exo-inbound-smtp-dane-dnssec/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.93f625d739f1d6a5c6f20c146bc6a8d26b233492b34b2220c54b12fd46a04ded.css" integrity="sha256-k/Yl1znx1qXG8gwUa8ao0msjNJKzSyIgxUsS/UagTe0=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://vand3rlinden.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://vand3rlinden.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://vand3rlinden.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://vand3rlinden.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://vand3rlinden.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://vand3rlinden.com/post/exo-inbound-smtp-dane-dnssec/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="https://vand3rlinden.com/post/exo-inbound-smtp-dane-dnssec/">
  <meta property="og:site_name" content="VAND3RLINDEN">
  <meta property="og:title" content="Exchange Online: Configure inbound SMTP DANE with DNSSEC">
  <meta property="og:description" content=" In this post, you will learn how to enable and use SMTP DANE with DNSSEC in Exchange Online.
While outbound SMTP DANE with DNSSEC in Exchange Online has been enabled since 2022, Microsoft is has rolling out inbound SMTP DANE with DNSSEC in Exchange Online since late 2024.
For a deeper understanding of DNSSEC and DANE, take a look at my earlier blog post.
How SMTP DANE with DNSSEC works SMTP DANE is a security protocol that uses DNSSEC to verify the authenticity of TLS certificates used for securing email communication. It helps protect against attacks such as TLS downgrade and man-in-the-middle attacks by ensuring that the certificates and encryption settings used in mail server communications are authentic and trustworthy.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-07-28T01:13:44+02:00">
    <meta property="article:modified_time" content="2024-07-28T01:13:44+02:00">
    <meta property="og:image" content="https://vand3rlinden.com/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec-front.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://vand3rlinden.com/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec-front.png">
<meta name="twitter:title" content="Exchange Online: Configure inbound SMTP DANE with DNSSEC">
<meta name="twitter:description" content="
In this post, you will learn how to enable and use SMTP DANE with DNSSEC in Exchange Online.
While outbound SMTP DANE with DNSSEC in Exchange Online has been enabled since 2022, Microsoft is has rolling out inbound SMTP DANE with DNSSEC in Exchange Online since late 2024.

For a deeper understanding of DNSSEC and DANE, take a look at my earlier blog post.
How SMTP DANE with DNSSEC works
SMTP DANE is a security protocol that uses DNSSEC to verify the authenticity of TLS certificates used for securing email communication. It helps protect against attacks such as TLS downgrade and man-in-the-middle attacks by ensuring that the certificates and encryption settings used in mail server communications are authentic and trustworthy.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://vand3rlinden.com/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Exchange Online: Configure inbound SMTP DANE with DNSSEC",
      "item": "https://vand3rlinden.com/post/exo-inbound-smtp-dane-dnssec/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Exchange Online: Configure inbound SMTP DANE with DNSSEC",
  "name": "Exchange Online: Configure inbound SMTP DANE with DNSSEC",
  "description": " In this post, you will learn how to enable and use SMTP DANE with DNSSEC in Exchange Online.\nWhile outbound SMTP DANE with DNSSEC in Exchange Online has been enabled since 2022, Microsoft is has rolling out inbound SMTP DANE with DNSSEC in Exchange Online since late 2024.\nFor a deeper understanding of DNSSEC and DANE, take a look at my earlier blog post.\nHow SMTP DANE with DNSSEC works SMTP DANE is a security protocol that uses DNSSEC to verify the authenticity of TLS certificates used for securing email communication. It helps protect against attacks such as TLS downgrade and man-in-the-middle attacks by ensuring that the certificates and encryption settings used in mail server communications are authentic and trustworthy.\n",
  "keywords": [
    
  ],
  "articleBody": " In this post, you will learn how to enable and use SMTP DANE with DNSSEC in Exchange Online.\nWhile outbound SMTP DANE with DNSSEC in Exchange Online has been enabled since 2022, Microsoft is has rolling out inbound SMTP DANE with DNSSEC in Exchange Online since late 2024.\nFor a deeper understanding of DNSSEC and DANE, take a look at my earlier blog post.\nHow SMTP DANE with DNSSEC works SMTP DANE is a security protocol that uses DNSSEC to verify the authenticity of TLS certificates used for securing email communication. It helps protect against attacks such as TLS downgrade and man-in-the-middle attacks by ensuring that the certificates and encryption settings used in mail server communications are authentic and trustworthy.\nWhile SPF, DKIM, and DMARC focus on verifying the authenticity of email messages and ensuring they are sent from authorized domains, SMTP DANE focuses specifically on securely establishing TLS connections between mail servers. By leveraging DNSSEC to publish certificate information directly in DNS, SMTP DANE ensures that the sending mail server connects to the intended receiving mail server with verified encryption, enhancing the overall security of email transport.\nThe flow of SMTP DANE on a mailserver Outbound SMTP DANE with DNSSEC sending mail server: Requests DANE TLSA records of the receiving domain’s MX record. Inbound SMTP DANE with DNSSEC receiving mail server: Requires DNSSEC and DANE TLSA records that can be requested by the sending mail server. TLS Reporting (TLSRPT): If the sending mail server encounters issues delivering an email, it can use the receiving server’s TLSRPT record to report the problem or confirm that the TLS session was successfully established. Prerequisites Before you enable inbound SMTP DANE with DNSSEC in Exchange Online for a domain, you must have added the domain as an Accepted domain and the domain status must be Healthy in the Microsoft 365 Admin Center. The current domain’s MX record must have a priority of 0 or 10 and must not have a fallback or secondary MX record.\nMake sure that DNSSEC is enabled for your domain at your DNS provider.\nYou can use the DNSSEC Analyzer from VeriSign, to check if your DNS provider have DNSSEC enabled for your domain. You must be authorized to access Exchange Online PowerShell and to run the cmdlets.\nThe domain you want to secure with inbound SMTP DANE with DNSSEC must referenced to an MX record such as yourdomain-com.mail.protection.outlook.com.\nTo configure inbound SMTP DANE with DNSSEC for your Accepted Domain, such as yourdomain.com, ensure that:\nIf this domain is referenced in any smarthost configurations, or in any connectors, you need to switch the smarthost name to tenantname.mail.protection.outlook.com Your business partners update their connectors to tenantname.onmicrosoft.com or tenantname.mail.protection.outlook.com to avoid failures. After enabling DANE, partners can switch to the new yourdomain-com..mx.microsoft endpoint to restore the original connection. Set up inbound SMTP DANE with DNSSEC in Exchange Online Below is a simplified version of the implementation compared to the official Microsoft Learn documentation.\nUpdate the TTL of your existing MX record to the lowest possible value (not lower than 30 seconds). Then, wait for the previous TTL to expire before proceeding. For example, if the TTL of your existing MX record was 3600 seconds or 1 hour before you changed it, you need to wait 1 hour before proceeding. Connect to Exchange Online PowerShell If you’re using MTA-STS, you’ll need to set your policy mode to testing during configuration, and set it back to enforced after configuration.\nEnable DNSSEC on your accepted domain by running the cmdlet in PowerShell: Enable-DnssecForVerifiedDomain -DomainName yourdomain.com Take the DnssecMxValue value, navigate to the DNS registrar hosting the domain, add a new MX record: 20 yourdomain-com..mx.microsoft and set the TTL to the lowest possible value (not lower than 30 seconds). Verify that the new MX is working via the Inbound SMTP Email test Change the priority of the legacy MX record yourdomain-com.mail.protection.outlook.com from current priority to 30 (30 yourdomain-com.mail.protection.outlook.com) Wait a minute\nChange the priority of the new MX record to 0 (0 yourdomain-com..mx.microsoft) Wait a minute\nDelete the legacy MX record yourdomain-com.mail.protection.outlook.com Wait a minute\nUpdate the TTL for the new MX record yourdomain-com..mx.microsoft to 3600 seconds or 1 hour Enable SMTP DANE for that same domain once the DNSSEC enablement is complete by running the cmdlet: Enable-SmtpDaneInbound -DomainName yourdomain.com Verify that the TLSA record has been propagated (this can take 15-30 minutes) by using the DANE Validation in Microsoft Remote Connectivity Analyzer Check the health of your domain’s MX record in the Microsoft 365 Admin Center under ‘DNS Records’. Cmdlets to get DNSSEC and SMTP DANE configuration settings in Exchange Online # DNSSEC Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com | Select-Object DnssecFeatureStatus $DNSSEC = Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com $DNSSEC.ExpectedMxRecord $DNSSEC = Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com $DNSSEC.DnsValidation $DNSSEC = Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com $DNSSEC.MxValidation # DNSSEC - MTA-STS Policy validation (check the validation only if you use an MTA-STS policy) $DNSSEC = Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com $DNSSEC.MtaStsValidation # SMTP DANE Get-SmtpDaneInboundStatus -DomainName yourdomain.com Check the TLSA record The TLSA records are listed in: _25._tcp.yourdomain-com..mx.microsoft\nActivate TLS Reporting (TLSRPT) TLS Reporting (TLSRPT) is a standard that provides a way to report when the TLS connection could not be established during email transmission.\nImplementation of TLSRPT Log in to your DNS hosting provider’s management console. Add a new TXT record with the following details: Host Type Value _smtp._tls.example.com TXT v=TLSRPTv1; rua=mailto:tlsrpt@example.com TLSRPT report handling If a sending mail server is having trouble securely delivering mail to a receiving mail server, the sending mail server can use the receiving mail server’s TLSRPT record to find out where to send a report about the problem or to report a successful session.\nThe reports are received in .json, you can look for the summary tag to check if the TLS connection was failed or successful:\n\"summary\":{\"total-successful-session-count\":1,\"total-failure-session-count\":0} Reference Announcing General Availability of Inbound SMTP DANE with DNSSEC for Exchange Online How SMTP DNS-based Authentication of Named Entities (DANE) works DNSSEC Analyzer TLSRPT is defined in RFC8460 TLS-RPT Record Checker ",
  "wordCount" : "991",
  "inLanguage": "en",
  "image":"https://vand3rlinden.com/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec-front.png","datePublished": "2024-07-28T01:13:44+02:00",
  "dateModified": "2024-07-28T01:13:44+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://vand3rlinden.com/post/exo-inbound-smtp-dane-dnssec/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "VAND3RLINDEN",
    "logo": {
      "@type": "ImageObject",
      "url": "https://vand3rlinden.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://vand3rlinden.com/" accesskey="h" title="VAND3RLINDEN (Alt + H)">VAND3RLINDEN</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://vand3rlinden.com/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://vand3rlinden.com/post/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://vand3rlinden.com/pgp" title="PGP">
                    <span>PGP</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://vand3rlinden.com/">Home</a>&nbsp;»&nbsp;<a href="https://vand3rlinden.com/post/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Exchange Online: Configure inbound SMTP DANE with DNSSEC
    </h1>
    <div class="post-meta"><span title='2024-07-28 01:13:44 +0200 CEST'>July 28, 2024</span>&nbsp;·&nbsp;5 min

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" src="https://vand3rlinden.com/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec-front.png" alt="">
        
</figure>
  <div class="post-content"><blockquote>
<p><em>In this post, you will learn how to enable and use SMTP DANE with DNSSEC in Exchange Online.</em></p></blockquote>
<p>While <em><strong>outbound</strong></em> SMTP DANE with DNSSEC in Exchange Online has been enabled since 2022, Microsoft is has rolling out <em><strong>inbound</strong></em> SMTP DANE with DNSSEC in Exchange Online since late 2024.</p>
<blockquote>
<p>For a deeper understanding of DNSSEC and DANE, take a look at my earlier <a href="https://vand3rlinden.com/post/dnssec-dane-explained/">blog post</a>.</p></blockquote>
<h2 id="how-smtp-dane-with-dnssec-works">How SMTP DANE with DNSSEC works<a hidden class="anchor" aria-hidden="true" href="#how-smtp-dane-with-dnssec-works">#</a></h2>
<p>SMTP DANE is a security protocol that uses DNSSEC to verify the authenticity of TLS certificates used for securing email communication. It helps protect against attacks such as TLS downgrade and man-in-the-middle attacks by ensuring that the certificates and encryption settings used in mail server communications are authentic and trustworthy.</p>
<p>While SPF, DKIM, and DMARC focus on verifying the authenticity of email messages and ensuring they are sent from authorized domains, SMTP DANE focuses specifically on securely establishing TLS connections between mail servers. By leveraging DNSSEC to publish certificate information directly in DNS, SMTP DANE ensures that the sending mail server connects to the intended receiving mail server with verified encryption, enhancing the overall security of email transport.</p>
<h2 id="the-flow-of-smtp-dane-on-a-mailserver">The flow of SMTP DANE on a mailserver<a hidden class="anchor" aria-hidden="true" href="#the-flow-of-smtp-dane-on-a-mailserver">#</a></h2>
<ul>
<li><strong>Outbound SMTP DANE with DNSSEC <code>sending mail server</code></strong>: Requests DANE <code>TLSA</code> records of the receiving domain&rsquo;s <code>MX</code> record.</li>
<li><strong>Inbound SMTP DANE with DNSSEC <code>receiving mail server</code></strong>: Requires DNSSEC and DANE <code>TLSA</code> records that can be requested by the sending mail server.</li>
<li><strong>TLS Reporting (TLSRPT)</strong>: If the sending mail server encounters issues delivering an email, it can use the receiving server’s <code>TLSRPT</code> record to report the problem or confirm that the TLS session was successfully established.</li>
</ul>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/smtpdane-tlsrpt-visual.png"></p>
<h2 id="prerequisites">Prerequisites<a hidden class="anchor" aria-hidden="true" href="#prerequisites">#</a></h2>
<ul>
<li>
<p>Before you enable inbound SMTP DANE with DNSSEC in Exchange Online for a domain, you must have added the domain as an Accepted domain and the domain status must be Healthy in the Microsoft 365 Admin Center. The current domain&rsquo;s <code>MX</code> record must have a priority of <code>0</code> or <code>10</code> and must not have a fallback or secondary <code>MX</code> record.</p>
</li>
<li>
<p>Make sure that DNSSEC is enabled for your domain at your DNS provider.</p>
<ul>
<li>You can use the <a href="https://dnssec-analyzer.verisignlabs.com/">DNSSEC Analyzer</a> from VeriSign, to check if your DNS provider have DNSSEC enabled for your domain.</li>
</ul>
</li>
<li>
<p>You must be authorized to access Exchange Online PowerShell and to run the cmdlets.</p>
</li>
<li>
<p>The domain you want to secure with inbound SMTP DANE with DNSSEC must referenced to an <code>MX</code> record such as <code>yourdomain-com.mail.protection.outlook.com</code>.</p>
</li>
<li>
<p>To configure inbound SMTP DANE with DNSSEC for your Accepted Domain, such as <code>yourdomain.com</code>, ensure that:</p>
<ul>
<li>If this domain is referenced in any smarthost configurations, or in any connectors, you need to switch the smarthost name to <code>tenantname.mail.protection.outlook.com</code></li>
<li>Your business partners update their connectors to <code>tenantname.onmicrosoft.com</code> or <code>tenantname.mail.protection.outlook.com</code> to avoid failures. After enabling DANE, partners can switch to the new <code>yourdomain-com.&lt;random&gt;.mx.microsoft</code> endpoint to restore the original connection.</li>
</ul>
</li>
</ul>
<h2 id="set-up-inbound-smtp-dane-with-dnssec-in-exchange-online">Set up inbound SMTP DANE with DNSSEC in Exchange Online<a hidden class="anchor" aria-hidden="true" href="#set-up-inbound-smtp-dane-with-dnssec-in-exchange-online">#</a></h2>
<p>Below is a simplified version of the implementation compared to the official <a href="https://learn.microsoft.com/en-us/purview/how-smtp-dane-works#set-up-inbound-smtp-dane-with-dnssec">Microsoft Learn documentation</a>.</p>
<ol>
<li>Update the <code>TTL</code> of your existing <code>MX</code> record to the lowest possible value (not lower than <code>30</code> seconds). Then, wait for the previous <code>TTL</code> to expire before proceeding. For example, if the <code>TTL</code> of your existing <code>MX</code> record was <code>3600</code> seconds or <code>1</code> hour before you changed it, you need to wait 1 hour before proceeding.</li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec1.png"></p>
<ol start="2">
<li>Connect to Exchange Online PowerShell</li>
</ol>
<blockquote>
<p>If you&rsquo;re using <a href="https://vand3rlinden.com/post/mta-sts-explained/">MTA-STS</a>, you&rsquo;ll need to set your policy mode to <code>testing</code> during configuration, and set it back to <code>enforced</code> after configuration.</p></blockquote>
<ol start="3">
<li>Enable DNSSEC on your accepted domain by running the cmdlet in PowerShell: <code>Enable-DnssecForVerifiedDomain -DomainName yourdomain.com</code></li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec2.png"></p>
<ol start="4">
<li>Take the <code>DnssecMxValue</code> value, navigate to the DNS registrar hosting the domain, add a new <code>MX</code> record: <code>20 yourdomain-com.&lt;random&gt;.mx.microsoft</code> and set the <code>TTL</code> to the lowest possible value (not lower than <code>30</code> seconds).</li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec3.png"></p>
<ol start="5">
<li>Verify that the new <code>MX</code> is working via the <a href="https://testconnectivity.microsoft.com/tests/O365InboundSmtp/input">Inbound SMTP Email test</a></li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec4.png"></p>
<ol start="6">
<li>Change the priority of the legacy <code>MX</code> record <code>yourdomain-com.mail.protection.outlook.com</code> from current priority to <code>30</code> (<code>30 yourdomain-com.mail.protection.outlook.com</code>)</li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec5.png"></p>
<blockquote>
<p>Wait a minute</p></blockquote>
<ol start="7">
<li>Change the priority of the new <code>MX</code> record to <code>0</code> (<code>0 yourdomain-com.&lt;random&gt;.mx.microsoft</code>)</li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec6.png"></p>
<blockquote>
<p>Wait a minute</p></blockquote>
<ol start="8">
<li>Delete the legacy <code>MX</code> record <code>yourdomain-com.mail.protection.outlook.com</code></li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec7.png"></p>
<blockquote>
<p>Wait a minute</p></blockquote>
<ol start="9">
<li>Update the <code>TTL</code> for the new <code>MX</code> record <code>yourdomain-com.&lt;random&gt;.mx.microsoft</code> to <code>3600</code> seconds or <code>1</code> hour</li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec8.png"></p>
<ol start="10">
<li>Enable SMTP DANE for that same domain once the DNSSEC enablement is complete by running the cmdlet: <code>Enable-SmtpDaneInbound -DomainName yourdomain.com</code></li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec9.png"></p>
<ol start="11">
<li>Verify that the TLSA record has been propagated (this can take 15-30 minutes) by using the <a href="https://testconnectivity.microsoft.com/tests/O365DaneValidation/input">DANE Validation in Microsoft Remote Connectivity Analyzer</a></li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec10.png"></p>
<ol start="12">
<li>Check the health of your domain&rsquo;s <code>MX</code> record in the Microsoft 365 Admin Center under &lsquo;DNS Records&rsquo;.</li>
</ol>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec11.png"></p>
<h2 id="cmdlets-to-get-dnssec-and-smtp-dane-configuration-settings-in-exchange-online">Cmdlets to get DNSSEC and SMTP DANE configuration settings in Exchange Online<a hidden class="anchor" aria-hidden="true" href="#cmdlets-to-get-dnssec-and-smtp-dane-configuration-settings-in-exchange-online">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#75715e"># DNSSEC</span>
</span></span><span style="display:flex;"><span>Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com | Select-Object DnssecFeatureStatus
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$DNSSEC = Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com
</span></span><span style="display:flex;"><span>$DNSSEC.ExpectedMxRecord
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$DNSSEC = Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com
</span></span><span style="display:flex;"><span>$DNSSEC.DnsValidation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$DNSSEC = Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com
</span></span><span style="display:flex;"><span>$DNSSEC.MxValidation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DNSSEC - MTA-STS Policy validation (check the validation only if you use an MTA-STS policy)</span>
</span></span><span style="display:flex;"><span>$DNSSEC = Get-DnssecStatusForVerifiedDomain -DomainName yourdomain.com
</span></span><span style="display:flex;"><span>$DNSSEC.MtaStsValidation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SMTP DANE</span>
</span></span><span style="display:flex;"><span>Get-SmtpDaneInboundStatus -DomainName yourdomain.com
</span></span></code></pre></div><h2 id="check-the-tlsa-record">Check the TLSA record<a hidden class="anchor" aria-hidden="true" href="#check-the-tlsa-record">#</a></h2>
<p>The <code>TLSA</code> records are listed in: <code>_25._tcp.yourdomain-com.&lt;random&gt;.mx.microsoft</code></p>
<p><img alt="IMAGE" loading="lazy" src="/images/exo-inbound-smtp-dane-dnssec/exo-inbound-smtp-dane-dnssec12.png"></p>
<h2 id="activate-tls-reporting-tlsrpt">Activate TLS Reporting (TLSRPT)<a hidden class="anchor" aria-hidden="true" href="#activate-tls-reporting-tlsrpt">#</a></h2>
<p>TLS Reporting (TLSRPT) is a standard that provides a way to report when the TLS connection could not be established during email transmission.</p>
<h3 id="implementation-of-tlsrpt">Implementation of TLSRPT<a hidden class="anchor" aria-hidden="true" href="#implementation-of-tlsrpt">#</a></h3>
<ol>
<li>Log in to your DNS hosting provider&rsquo;s management console.</li>
<li>Add a new TXT record with the following details:</li>
</ol>
<table>
  <thead>
      <tr>
          <th>Host</th>
          <th>Type</th>
          <th>Value</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>_smtp._tls.example.com</code></td>
          <td><code>TXT</code></td>
          <td><code>v=TLSRPTv1; rua=mailto:tlsrpt@example.com</code></td>
      </tr>
  </tbody>
</table>
<h3 id="tlsrpt-report-handling">TLSRPT report handling<a hidden class="anchor" aria-hidden="true" href="#tlsrpt-report-handling">#</a></h3>
<p>If a sending mail server is having trouble securely delivering mail to a receiving mail server, the sending mail server can use the receiving mail server&rsquo;s TLSRPT record to find out where to send a report about the problem or to report a successful session.</p>
<p>The reports are received in <code>.json</code>, you can look for the <code>summary</code> tag to check if the TLS connection was failed or successful:</p>
<pre tabindex="0"><code>&#34;summary&#34;:{&#34;total-successful-session-count&#34;:1,&#34;total-failure-session-count&#34;:0}
</code></pre><h2 id="reference">Reference<a hidden class="anchor" aria-hidden="true" href="#reference">#</a></h2>
<ul>
<li><a href="https://techcommunity.microsoft.com/blog/exchange/announcing-general-availability-of-inbound-smtp-dane-with-dnssec-for-exchange-on/4281292">Announcing General Availability of Inbound SMTP DANE with DNSSEC for Exchange Online</a></li>
<li><a href="https://learn.microsoft.com/en-us/purview/how-smtp-dane-works">How SMTP DNS-based Authentication of Named Entities (DANE) works</a></li>
<li><a href="https://dnssec-analyzer.verisignlabs.com/">DNSSEC Analyzer</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8460">TLSRPT is defined in RFC8460</a></li>
<li><a href="https://easydmarc.com/tools/tls-rpt-check">TLS-RPT Record Checker</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://vand3rlinden.com/post/mta-sts-explained/">
    <span class="title">« Prev</span>
    <br>
    <span>MTA-STS Explained: A Comprehensive guide to the MTA-STS Policy</span>
  </a>
  <a class="next" href="https://vand3rlinden.com/post/mdo-safeattachments-policies/">
    <span class="title">Next »</span>
    <br>
    <span>Microsoft Defender for Office 365: Safe Attachments policies</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Exchange Online: Configure inbound SMTP DANE with DNSSEC on x"
            href="https://x.com/intent/tweet/?text=Exchange%20Online%3a%20Configure%20inbound%20SMTP%20DANE%20with%20DNSSEC&amp;url=https%3a%2f%2fvand3rlinden.com%2fpost%2fexo-inbound-smtp-dane-dnssec%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Exchange Online: Configure inbound SMTP DANE with DNSSEC on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fvand3rlinden.com%2fpost%2fexo-inbound-smtp-dane-dnssec%2f&amp;title=Exchange%20Online%3a%20Configure%20inbound%20SMTP%20DANE%20with%20DNSSEC&amp;summary=Exchange%20Online%3a%20Configure%20inbound%20SMTP%20DANE%20with%20DNSSEC&amp;source=https%3a%2f%2fvand3rlinden.com%2fpost%2fexo-inbound-smtp-dane-dnssec%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Exchange Online: Configure inbound SMTP DANE with DNSSEC on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fvand3rlinden.com%2fpost%2fexo-inbound-smtp-dane-dnssec%2f&title=Exchange%20Online%3a%20Configure%20inbound%20SMTP%20DANE%20with%20DNSSEC">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Exchange Online: Configure inbound SMTP DANE with DNSSEC on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fvand3rlinden.com%2fpost%2fexo-inbound-smtp-dane-dnssec%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Exchange Online: Configure inbound SMTP DANE with DNSSEC on whatsapp"
            href="https://api.whatsapp.com/send?text=Exchange%20Online%3a%20Configure%20inbound%20SMTP%20DANE%20with%20DNSSEC%20-%20https%3a%2f%2fvand3rlinden.com%2fpost%2fexo-inbound-smtp-dane-dnssec%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Exchange Online: Configure inbound SMTP DANE with DNSSEC on telegram"
            href="https://telegram.me/share/url?text=Exchange%20Online%3a%20Configure%20inbound%20SMTP%20DANE%20with%20DNSSEC&amp;url=https%3a%2f%2fvand3rlinden.com%2fpost%2fexo-inbound-smtp-dane-dnssec%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Exchange Online: Configure inbound SMTP DANE with DNSSEC on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Exchange%20Online%3a%20Configure%20inbound%20SMTP%20DANE%20with%20DNSSEC&u=https%3a%2f%2fvand3rlinden.com%2fpost%2fexo-inbound-smtp-dane-dnssec%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://vand3rlinden.com/">VAND3RLINDEN</a></span> · 

    <span>
        <a href="https://vand3rlinden.com/privacy-policy" rel="noopener noreferrer" target="_blank">Privacy Policy</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
